<!DOCTYPE html>
<html>
<head>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

        body { margin: 0; padding: 20px; font-family: 'Share Tech Mono', monospace; background: transparent; overflow: hidden; }

        .cyber-card {
            display: flex; align-items: flex-end; width: 400px; padding: 10px;
            background: linear-gradient(90deg, rgba(0,0,0,0.9) 0%, rgba(10,10,20,0.8) 100%);
            border-left: 4px solid #00f3ff;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
            clip-path: polygon(0 0, 100% 0, 100% 85%, 95% 100%, 0 100%);
            position: relative; transition: all 0.3s;
        }

        .art-box { width: 80px; height: 80px; position: relative; border: 1px solid #ff00ff; margin-right: 15px; }
        .art-box img { width: 100%; height: 100%; object-fit: cover; }
        .playing .art-box { box-shadow: 0 0 10px #ff00ff; animation: pulse 2s infinite; }

        .meta { flex: 1; display: flex; flex-direction: column; gap: 2px; }
        .track { color: #00f3ff; font-size: 18px; text-transform: uppercase; text-shadow: 0 0 5px rgba(0,243,255,0.7); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 280px; }
        .author { color: #fff; font-size: 14px; opacity: 0.8; }

        .time-rail { width: 100%; height: 6px; background: #222; margin-top: 8px; position: relative; border: 1px solid #333; }
        .time-fill { height: 100%; background: #ff00ff; width: 0%; box-shadow: 0 0 8px #ff00ff; transition: width 1s linear; }

        @keyframes pulse { 0% { box-shadow: 0 0 5px #ff00ff; } 50% { box-shadow: 0 0 20px #ff00ff; } 100% { box-shadow: 0 0 5px #ff00ff; } }
    </style>
</head>
<body>
    <div id="player" class="cyber-card">
        <div class="art-box"><img id="art" src="" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSJibGFjayI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiLz48L3N2Zz4='"></div>
        <div class="meta">
            <div id="title" class="track">DISCONNECTED</div>
            <div id="artist" class="author">SYSTEM OFFLINE</div>
            <div class="time-rail"><div id="prog" class="time-fill"></div></div>
        </div>
    </div>
    <script>
        // Logique commune (Fetch + Update) avec URL corrigÃ©e
        setInterval(() => {
            fetch('/api/current-track').then(r=>r.json()).then(d => {
                const el = (id) => document.getElementById(id);
                document.getElementById('player').classList.toggle('playing', d.is_playing);
                el('title').innerText = d.title || 'No Data';
                el('artist').innerText = d.artist || '';
                el('art').src = d.thumbnail || '';
                el('prog').style.width = d.duration ? ((d.position/d.duration)*100)+'%' : '0%';
            }).catch(()=>{});
        }, 1000);
    </script>
</body>
</html>
