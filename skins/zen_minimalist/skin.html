<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <style>
        :root { --bg: rgba(20, 20, 20, 0.95); --text: #ffffff; --sub: #a0a0a0; --accent: #ffffff; }
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; overflow: hidden; background: transparent; }

        .card {
            display: flex; align-items: center; width: 450px; height: 110px;
            background: var(--bg); border-radius: 16px; padding: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); backdrop-filter: blur(10px);
            opacity: 0; transition: opacity 0.5s ease; position: relative; overflow: hidden;
        }
        .card.visible { opacity: 1; }

        .cover-container { position: relative; width: 86px; height: 86px; flex-shrink: 0; }
        .cover { width: 100%; height: 100%; border-radius: 10px; object-fit: cover; position: relative; z-index: 2; box-shadow: 0 4px 12px rgba(0,0,0,0.4); }

        .info { flex: 1; margin-left: 16px; display: flex; flex-direction: column; justify-content: center; overflow: hidden; }
        .title { font-size: 16px; font-weight: 700; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px; }
        .artist { font-size: 14px; font-weight: 500; color: var(--sub); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .progress-container { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 12px; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.5s linear; border-radius: 2px; }

        /* État Pause */
        .paused .cover { filter: grayscale(100%); transition: filter 0.3s; }
    </style>
</head>
<body>
    <div id="player" class="card">
        <div class="cover-container">
            <img id="art" class="cover" src="" alt="Album Art">
        </div>
        <div class="info">
            <div id="title" class="title">Waiting for music...</div>
            <div id="artist" class="artist">-</div>
            <div class="progress-container">
                <div id="prog" class="progress-bar"></div>
            </div>
        </div>
    </div>

    <script>
        const updateUI = (data) => {
            const player = document.getElementById('player');
            if (!data || !data.title) { player.classList.remove('visible'); return; }

            player.classList.add('visible');
            player.classList.toggle('paused', !data.is_playing);

            document.getElementById('title').textContent = data.title;
            document.getElementById('artist').textContent = data.artist;
            document.getElementById('art').src = data.thumbnail || 'https://via.placeholder.com/100/333/FFF?text=Music';

            const percent = (data.position / data.duration) * 100;
            document.getElementById('prog').style.width = `${Math.min(100, percent)}%`;
        };

        // Boucle de fetch avec URL corrigée
        setInterval(() => {
            fetch('/api/current-track').then(r => r.json()).then(updateUI).catch(e => console.log('No server'));
        }, 1000);
    </script>
</body>
</html>
